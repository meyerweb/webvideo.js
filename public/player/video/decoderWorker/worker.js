var y=(e,r,o)=>{if(!r.has(e))throw TypeError("Cannot "+o)};var i=(e,r,o)=>(y(e,r,"read from private field"),o?o.call(e):r.get(e)),D=(e,r,o)=>{if(r.has(e))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(e):r.set(e,o)},v=(e,r,o,n)=>(y(e,r,"write to private field"),n?n.call(e,o):r.set(e,o),o);function A(e){return{videoUrl:e.videoUrl,loglevel:e.loglevel,playState:M.fromBuffer(e.playState),videoBufferFull:l.fromBuffer(e.videoBufferFull),audioBufferFull:l.fromBuffer(e.audioBufferFull),videoDecoderShouldBeDead:l.fromBuffer(e.videoDecoderShouldBeDead),audioDecoderShouldBeDead:l.fromBuffer(e.audioDecoderShouldBeDead)}}var V;(function(t){t[t.STOPPED=-1]="STOPPED",t[t.PLAYING=0]="PLAYING",t[t.PAUSED=1]="PAUSED",t[t.BUFFERING=2]="BUFFERING",t[t.SEEKING=3]="SEEKING"})(V||(V={}));var f,h=class{constructor(r){D(this,f,void 0);let o=new SharedArrayBuffer(4);v(this,f,new Int32Array(o)),i(this,f)[0]=r}static fromBuffer(r){let o=-1,n=new h(o);return v(n,f,r),n}load(){return Atomics.load(i(this,f),0)}store(r){Atomics.store(i(this,f),0,r),Atomics.notify(i(this,f),0)}buf(){return i(this,f)}},M=h;f=new WeakMap;var s,S,b,c=class{constructor(r){D(this,s,void 0);let o=new SharedArrayBuffer(4);v(this,s,new Int32Array(o)),i(this,s)[0]=r?i(c,S):i(c,b)}static fromBuffer(r){let o=!1,n=new c(o);return v(n,s,r),n}load(){return Atomics.load(i(this,s),0)===i(c,S)}store(r){Atomics.store(i(this,s),0,r?i(c,S):i(c,b)),Atomics.notify(i(this,s),0)}buf(){return i(this,s)}sab(){return i(this,s).buffer}},l=c;s=new WeakMap,S=new WeakMap,b=new WeakMap,D(l,S,1),D(l,b,0);function g(e){return new Promise(r=>{setTimeout(()=>{r()},e)})}async function x(e="MP4Box"){let r=await import(new URL(`./media/format/demuxer${e}.js`,location.origin).href);return new r.MP4BoxMediaDemuxer}async function E(e="WebCodecs",r){let o=await import(new URL(`./media/codec/decoder${e}.js`,location.origin).href);return new o.WebCodecsMediaDecoder(r)}var u;(function(t){t[t.TRACE=0]="TRACE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR"})(u||(u={}));var m;(function(a){a.BLACK="[30m",a.RED="[31m",a.GREEN="[32m",a.YELLOW="[33m",a.BLUE="[34m",a.MAGENTA="[35m",a.CYAN="[36m",a.WHITE="[37m",a.NONE=""})(m||(m={}));function F(e,r){if(r===m.NONE)return e;{let o="[0m";return r+e+o}}function w(e){return e?`[${e}]`:""}var I={loglevel:3};function k(e){typeof self!="undefined"&&(self.__wv_global_loglevel=e),I.loglevel=e}function R(){return typeof self!="undefined"?self.__wv_global_loglevel:I.loglevel}function p(e,r,o){if(e<R())return;let n=console.log,W=m.NONE;switch(e){case 0:{n=console.log,W=m.WHITE;break}case 1:{n=console.debug,W=m.CYAN;break}case 2:{n=console.info,W=m.GREEN;break}case 3:{n=console.warn;break}case 4:{n=console.error;break}}n(F([w(o),r].filter(t=>t).join(" "),W))}function N(e,r){p(0,e,r)}function U(e,r){p(1,e,r)}function O(e,r){p(2,e,r)}function G(e,r){p(3,e,r)}function P(e,r){p(4,e,r)}var B={setLevel:k,trace:N,debug:U,info:O,warn:G,error:P};var d={};self.addEventListener("message",async e=>{switch(e.data.msg){case"Main_requestVideoDecoderStart":{d.sharedState=A(e.data.sharedState),B.setLevel(d.sharedState.loglevel),d.decoder=await E("WebCodecs",await x("MP4Box"));let r=await d.decoder.open(d.sharedState.videoUrl,"video");if(d.videoStream=r.streams.filter(o=>o.type==="video")[0],!d.videoStream){B.error("No video stream found","WVVideoDecoderWorker");return}self.postMessage({msg:"VideoDecoder_sendVideoStreamInfo",videoStream:d.videoStream});break}case"Main_requestVideoDecoderDecode":{if(!d.videoStream||!d.decoder){B.error("VideoDecoderWorkerState is not initialized","WVVideoDecoderWorker");return}for await(let r of d.decoder.decode(d.videoStream.streamIndex)){if(d.sharedState.videoDecoderShouldBeDead.load())break;if(r.eof){B.debug("eof detected","WVVideoDecoderWorker");break}if(r.frame&&r.frame.type()==="video"){for(;d.sharedState.videoBufferFull.load();)if(Atomics.wait(d.sharedState.videoBufferFull.buf(),0,1,10*1e3),d.sharedState.videoDecoderShouldBeDead.load())return;let o=r.frame.nativeFrame();self.postMessage({msg:"VideoDecoder_sendVideoFrame",frame:o},[o]);continue}await g(4)}break}case"Main_requestVideoDecoderClose":{d.decoder&&await d.decoder.destroy(),self.postMessage({msg:"VideoDecoder_notifyClosed"});break}}});
